function getUrlParameter(e){if(window.location.getParameter)return window.location.getParameter(e);if(location.search)for(var t=location.search.substring(1).split("&"),n=0;n<t.length;n++){var r=t[n].split("=");if(r[0]&&r[0]==e)return r[1]||!0}}function generateUUID(){var e=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(e+=performance.now());var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)});return t}function clamp(e,t,n){return e<=t?t:e>=n?n:e}var DIRECTION={left:37,up:38,right:39,down:40,leftup:3738,rightup:3938,leftdown:3740,rightdown:3940,none:0,horizontal:1,vertical:2},KEY={left:37,up:38,right:39,down:40,space:32,ctrl:17,enter:13,action:1e3},EVENT={keyDown:1,keyUp:2,select:3,screenUpdate:4,tick:5,step:6},EventBus=function(){var e={},t={};return t.onEvent=function(t,n){var r=e[t];r||(r=[],e[t]=r),r.push(n)},t.sendEvent=function(t,n){var r=e[t];if(r){var i,a=r.length;for(i=0;i<a;i++)r[i](n,t)}},t.trigger=function(e,n){t.sendEvent(e,n)},t.on=function(e,n){t.onEvent(e,n)},t}(),Yascal=function(){var e={};return e.init=function(t){e.screen.init(t),e.touchInput.init(e.canvas)},e.sprites={},e.getImage=function(t){return e.sprites[t]?e.sprites[t].canvas:void 0},e.loadImage=function(e,t){var n=new Image;n.onload=function(){t&&t(n)},n.onerror=function(){},n.src=e},e.getModalElement=function(){},e.getEventElement=function(t,n){for(var r=void 0,i=0,a=e.screen.children.length;i<a;i++){var o=e.screen.children[i];if(o.isVisible()&&o.containsPoint(t,n)){r=o;break}}return r&&r.children&&r.children.length&&(r=r.getElementAtPoint(t,n)),r},e}(),Y=Yascal;Yascal.properties=function(e){if(e&&e.isYascal)return e;var t=e||{};return t.isYascal=!0,t.get=function(e,n){return"undefined"==typeof t[e]?n:t[e]},t.set=function(e,n){t[e]=n},t.has=function(e){return"undefined"!=typeof t[e]},t},Yascal.util=function(e){var t={};return t}(),Yascal.screen=function(){var e={};e.name="mainScreen",e.visible=!0,e.children=[];var r,i,o,t=[],n={},a=!0,c=1,s=1;e.backGroundColor="black",e.backGroundImage;var l,u=0;return e.init=function(t){t=Y.properties(t),r=t.canvas||document.createElement("canvas"),Y.canvas=e.canvas=r,t.useWebGL&&"object"==typeof YascalGl&&(Y.useWebGL=!0),Y.useWebGL?(i=YGL.context(20,20,r),l=Yascal.renderer.webgl(i,e)):(i=r.getContext("2d"),l=Yascal.renderer.canvas2d(r,e)),Y.ctx=e.ctx=i,e.render()},e.setSize=function(e,t){l.setSize(e,t);var n=Math.min(window.innerHeight/t,window.innerWidth/e);r.style.position="absolute",r.style.width=e*n+"px",r.style.height=t*n+"px"},e.setScaleFactor=function(t){c=r.offsetWidth/r.width,s=r.offsetHeight/r.height,t&&window.addEventListener("resize",function(){e.setScaleFactor()},!0)},e.getScaleFactor=function(){return{width:c,height:s}},e.windowToCanvas=function(e,t){return{x:e/c,y:t/s}},e.canvasToWindow=function(e,t){return{x:e*c,y:t*s}},e.scaledX=function(e){return Math.round(e/c)},e.scaledY=function(e){return Math.round(e/s)},e.setProperties=function(t){t=Y.properties(t),e.backGroundColor=t.get("backGroundColor",e.backGroundColor),e.backGroundImage=t.get("backGroundImage",e.backGroundImage)},e.clear=function(){l.clear()},e.clearBackGroundImage=function(){e.backGroundImage=void 0},e.refresh=function(){a=!0},e.addChild=function(t){t.setParent(e),t.zIndex=t.zIndex||e.children.length,e.children.push(t),a=!0},e.render=function(r){window.requestAnimationFrame(e.render),Main.stats&&Main.stats.begin();var i=r-u;u=r,i<10||(i>1e3&&(i=16),i||(i=16),EventBus.trigger(EVENT.screenUpdate,i),t.forEach(function(e,i){if(e.canceled)delete n[e.id],t.splice(i,1);else{var o=r-e.start,c=Math.min(o/e.duration,1),s=e.easing||Yascal.easing.easeOutQuad,u=s(c);e.updatefunction(e.initialState,u),a=!0,1==c&&t.splice(i,1)}}),a&&(e.clear(),e.children.forEach(function(e){e.render()}),o&&(o.render(),a=!1),a=!1),Main.stats&&Main.stats.end())},e.registerAnimation=function(e,r,i,a){if(r){var o={id:generateUUID(),start:performance.now(),duration:1e3*r,easing:a,initialState:e,updatefunction:i};return t.push(o),n[o.id]=o,o.id}return!1},e.cancelAnimation=function(e){var t=n[e];t&&(t.canceled=!0)},e}(),Yascal.screen=function(){var e={};e.name="mainScreen",e.visible=!0,e.children=[];var r,i,o,t=[],n={},a=!0,c=1,s=1;e.backGroundColor="black",e.backGroundImage;var l,u=0;return e.init=function(t){t=Y.properties(t),r=t.canvas||document.createElement("canvas"),Y.canvas=e.canvas=r,t.useWebGL&&"object"==typeof YascalGl&&(Y.useWebGL=!0),Y.useWebGL?(i=YGL.context(20,20,r),l=Yascal.renderer.webgl(i,e)):(i=r.getContext("2d"),l=Yascal.renderer.canvas2d(r,e)),Y.ctx=e.ctx=i,e.render()},e.setSize=function(e,t){l.setSize(e,t);var n=Math.min(window.innerHeight/t,window.innerWidth/e);r.style.position="absolute",r.style.width=e*n+"px",r.style.height=t*n+"px"},e.setScaleFactor=function(t){c=r.offsetWidth/r.width,s=r.offsetHeight/r.height,t&&window.addEventListener("resize",function(){e.setScaleFactor()},!0)},e.getScaleFactor=function(){return{width:c,height:s}},e.windowToCanvas=function(e,t){return{x:e/c,y:t/s}},e.canvasToWindow=function(e,t){return{x:e*c,y:t*s}},e.scaledX=function(e){return Math.round(e/c)},e.scaledY=function(e){return Math.round(e/s)},e.setProperties=function(t){t=Y.properties(t),e.backGroundColor=t.get("backGroundColor",e.backGroundColor),e.backGroundImage=t.get("backGroundImage",e.backGroundImage)},e.clear=function(){l.clear()},e.clearBackGroundImage=function(){e.backGroundImage=void 0},e.refresh=function(){a=!0},e.addChild=function(t){t.setParent(e),t.zIndex=t.zIndex||e.children.length,e.children.push(t),a=!0},e.render=function(r){window.requestAnimationFrame(e.render),Main.stats&&Main.stats.begin();var i=r-u;u=r,i<10||(i>1e3&&(i=16),i||(i=16),EventBus.trigger(EVENT.screenUpdate,i),t.forEach(function(e,i){if(e.canceled)delete n[e.id],t.splice(i,1);else{var o=r-e.start,c=Math.min(o/e.duration,1),s=e.easing||Yascal.easing.easeOutQuad,u=s(c);e.updatefunction(e.initialState,u),a=!0,1==c&&t.splice(i,1)}}),a&&(e.clear(),e.children.forEach(function(e){e.render()}),o&&(o.render(),a=!1),a=!1),Main.stats&&Main.stats.end())},e.registerAnimation=function(e,r,i,a){if(r){var o={id:generateUUID(),start:performance.now(),duration:1e3*r,easing:a,initialState:e,updatefunction:i};return t.push(o),n[o.id]=o,o.id}return!1},e.cancelAnimation=function(e){var t=n[e];t&&(t.canceled=!0)},e}(),Yascal.sprite=function(e){var t={};if(Y.useWebGL)t.width=e.width,t.height=e.height,t.texture=e.img,t.x=e.x,t.y=e.y,t.region=YGL.textureRegion(e.img,t.x,t.y,t.width,t.height);else if(t.canvas=document.createElement("canvas"),t.ctx=t.canvas.getContext("2d"),e&&(e.width&&(t.canvas.width=e.width,t.canvas.height=e.height||e.width),e.img)){var n=e.x||0,r=e.y||0,i=t.canvas.width,a=t.canvas.height;t.ctx.drawImage(e.img,n,r,i,a,0,0,i,a)}return t},Y.spriteSheet=function(){var e={};return e.sprites=[],e.loadFromImage=function(t,n,r){var i,a=function(){r&&r()};if(!n)return void a();var o=function(t){if(n.tileWidth&&n.tileHeight){for(var r=n.tileWidth,i=n.tileHeight,o=Math.floor(t.width/r),c=Math.floor(t.height/i),s=o*c,u=0;u<s;u++){var l={width:r,height:i,img:t,x:u%o*r,y:Math.floor(u/o)*i};e.sprites.push(Y.sprite(l))}a()}};if(Y.useWebGL){var c=YGL.texture(Y.ctx,t,function(){o(c)});window.texture=c}else"string"==typeof t?Y.loadImage(t,function(e){i=e,o(i)}):o(t)},e},Yascal.easing=function(){var e={};return e.linear=function(e){return e},e.easeInSine=function(e){return-1*Math.cos(e*(Math.PI/2))+1},e.easeOutSine=function(e){return Math.sin(e*(Math.PI/2))},e.easeInOutSine=function(e){return-.5*(Math.cos(Math.PI*e)-1)},e.easeInQuad=function(e){return e*e},e.easeOutQuad=function(e){return e*(2-e)},e.easeInOutQuad=function(e){return.5>e?2*e*e:-1+(4-2*e)*e},e.easeInCubic=function(e){return e*e*e},e.easeOutCubic=function(e){var t=e-1;return t*t*t+1},e.easeOutQuint=function(e){var t=e-1;return 1+t*t*t*t*t},e.easeOutCirc=function(e){var t=e-1;return Math.sqrt(1-t*t)},e.easeOutElastic=function(e){var t=arguments.length<=1||void 0===arguments[1]?.7:arguments[1],n=1-t,r=2*e;if(0===e||1===e)return e;var i=n/(2*Math.PI)*Math.asin(1);return Math.pow(2,-10*r)*Math.sin((r-i)*(2*Math.PI)/n)+1},e.easeOutBounce=function(e){var t=e/1;if(1/2.75>t)return 7.5625*t*t;if(2/2.75>t){var n=t-1.5/2.75;return 7.5625*n*n+.75}if(2.5/2.75>t){var r=t-2.25/2.75;return 7.5625*r*r+.9375}var i=t-2.625/2.75;return 7.5625*i*i+.984375},e.easeInOutBounce=function(e){return.5>e?.5*_(2*e):.5*easeOutBounce(2*e-1)+.5},e}(),Yascal.keyInput=function(){function n(e){var n=e.keyCode;t[n]=a(n),t[n].isDown=!0,n!=KEY.space&&n!=KEY.ctrl&&n!=KEY.enter||(t[KEY.action]=a(KEY.action),t[KEY.action].isDown=!0),"undefined"!=typeof EventBus&&EventBus.trigger(EVENT.keyDown,n)}function r(e){var n=e.keyCode;t[n]=a(n),t[n].isDown=!1,n!=KEY.space&&n!=KEY.ctrl&&n!=KEY.enter||(t[KEY.action]=a(KEY.action),t[KEY.action].isDown=!1),"undefined"!=typeof EventBus&&EventBus.trigger(EVENT.keyUp,n)}function a(e){return t[e]||{}}var e={},t={};return document.addEventListener("keydown",n,!1),document.addEventListener("keyup",r,!1),e.isDown=function(t){return e.isKeyDown(KEY.down,t)},e.isUp=function(t){return e.isKeyDown(KEY.up,t)},e.isLeft=function(t){return e.isKeyDown(KEY.left,t)},e.isRight=function(t){return e.isKeyDown(KEY.right,t)},e.isAction=function(t){return e.isKeyDown(KEY.action,t)},e.isEnter=function(t){return e.isKeyDown(KEY.enter,t)},e.isKeyDown=function(e,n){return t[e]=a(e),"undefined"!=typeof n&&(t[e].isDown=n),t[e].isDown},e}(),Yascal.touchInput=function(){function i(e){function s(e,n,i){t.isTouchDown=!0;var a=r.getBoundingClientRect();n=Y.screen.scaledX(n-a.left),i=Y.screen.scaledY(i-a.top),currentEventTarget=Y.getModalElement()||Y.getEventElement(n,i);var o={id:e,x:n,y:i,startX:n,startY:i,UIobject:currentEventTarget};t.touches.push(o),o.UIobject&&(o.UIobject.onDragStart&&o.UIobject.onDragStart(o),o.UIobject.onTouchDown&&o.UIobject.onTouchDown(o))}if(e.preventDefault(),n||(n=!0),e.touches&&e.touches.length>0)for(var i=e.changedTouches,a=0;a<i.length;a++){var o=i[a];s(o.identifier,o.pageX,o.pageY)}else{var c=d("notouch");c>=0&&t.touches.splice(c,1),s("notouch",e.pageX,e.pageY)}}function a(e){function l(e,n,r){if(e>=0){var i=t.touches[e];i.x=n,i.y=r,t.touches.splice(e,1,i),t.isTouchDown&&i.UIobject&&i.UIobject.onDrag&&(i.dragX=n,i.dragY=r,i.isDragging=!0,i.UIobject.onDrag(i))}}e.preventDefault();var a,o,n=r.getBoundingClientRect();if(e.touches&&e.touches.length>0)for(var c=e.changedTouches,s=0;s<c.length;s++){var u=c[s];a=Y.screen.scaledX(u.pageX-n.left),o=Y.screen.scaledY(u.pageY-n.top),l(d(u.identifier),a,o)}else a=Y.screen.scaledX(e.pageX-n.left),o=Y.screen.scaledY(e.pageY-n.top),l(d("notouch"),a,o),t.currentMouseX=a,t.currentMouseY=o,t.mouseMoved=(new Date).getTime()}function o(e){function a(e){if(e>=0){var n=t.touches[e];if(n.UIobject){var r=n.UIobject;if(r.onClick){var i=n.startX-n.x,a=n.startY-n.y,o=Math.sqrt(i*i+a*a);o<8&&r.onClick(n)}r.onDragEnd&&r.onDragEnd(n),r.onTouchUp&&r.onTouchUp(n)}t.touches.splice(e,1)}}function o(){}if(t.isTouchDown=!1,e&&e.touches){for(var n=e.changedTouches,r=0;r<n.length;r++){var i=n[r];a(d(i.identifier))}0==e.touches.length&&o()}else a(d("notouch")),o()}function c(e){if(t.currentMouseX){var n=t.currentMouseX,r=t.currentMouseY,i=Y.getEventElement(n,r);if(i&&i.onMouseWheel){var a=e.wheelDeltaY||e.wheelDelta||-e.detail;e.wheelDeltaX||0;t.mouseWheels.unshift(a),t.mouseWheels.length>10&&t.mouseWheels.pop(),i.onMouseWheel(t)}}}function s(e){e.stopPropagation(),e.preventDefault()}function u(e){e.stopPropagation(),e.preventDefault()}function l(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer,n=t.files;Tracker.handleUpload(n)}var e={},t={};t.touches=[],t.mouseWheels=[];var r,n=!1;e.init=function(e){r=e,r.addEventListener("mousedown",i,!1),r.addEventListener("mousemove",a,!1),r.addEventListener("mouseup",o,!1),r.addEventListener("touchstart",i,!1),r.addEventListener("touchmove",a,!1),r.addEventListener("touchend",o,!1),window.navigator.msPointerEnabled&&(r.addEventListener("MSPointerDown",i,!1),r.addEventListener("MSPointerMove",a,!1),r.addEventListener("MSPointerEnd",o,!1)),r.addEventListener("mousewheel",c,!1),r.addEventListener("DOMMouseScroll",c,!1),r.addEventListener("dragenter",s,!1),r.addEventListener("dragover",u,!1),r.addEventListener("drop",l,!1)};var d=function(e){for(var n=0;n<t.touches.length;n++)if(t.touches[n].id===e)return n;return-1};return e}(),Yascal.ticker=function(){var n,e={},t=8,r=[],i=1e3/t,a=0,o=0,c=0;return e.start=function(){a=0,EventBus.on(EVENT.screenUpdate,function(e){if(n){var t=1e3/e,s=r.unshift(t);s>10&&r.pop()}a+=e,o+=e,EventBus.trigger(EVENT.tick,e),a>i&&(c++,a=0,EventBus.trigger(EVENT.step))})},e.stats=function(e){e&&(n=!0);for(var t=0,i=r.length,a=0;a<i;a++)t+=r[a];return t=Math.round(t/i)},e},Yascal.element=function(e){var t={};e=e||{},t.left=e.left||0,t.top=e.top||0,t.width=e.width||20,t.height=e.height||20,t.scale=1,t.visible=!0,t.needsRendering=!0,t.parentCtx=Y.ctx,t.canvas=document.createElement("canvas"),t.canvas.width=t.width,t.canvas.height=t.height,t.ctx=t.canvas.getContext("2d"),t.children=[],t.id=generateUUID();var n,r,i;return t.hide=function(e){t.visible=!1,e&&t.refresh()},t.show=function(e,n){t.visible=!0,e&&t.refresh(n)},t.toggle=function(){t.visible?t.hide():t.show()},t.isVisible=function(){for(var e=t.visible,n=t.parent;e&&n;)e=n.visible,n=n.parent;return e},t.containsPoint=function(e,t){var n=this.left,r=this.left+this.width,i=this.top,a=this.top+this.height;return e>=n&&e<=r&&t>=i&&t<=a},t.getElementAtPoint=function(e,n){e-=t.left,n-=t.top;for(var r,i=t.children.length-1;i>=0;i--){var a=t.children[i];if(a.isVisible()&&!a.ignoreEvents&&a.containsPoint(e,n)){r=a;break}}if(r){var o=r.getElementAtPoint(e,n);o?r=o:(r.eventX=e,r.eventY=n)}else r=t,r.eventX=e,r.eventY=n;return r},t.setParent=function(e){t.parent=e,e&&(t.parentCtx=e.ctx)},t.addChild=function(e){e.setParent(t),e.zIndex=e.zIndex||t.children.length,t.children.push(e)},t.getChild=function(e){for(var r,n=t.children.length;n;){if(r=t.children[n],r&&r.name&&r.name==e)return r;n--}},t.refresh=function(e){if(t.needsRendering=!0,e)for(var r,n=t.children.length;n;)r=t.children[n],r&&r.refresh(),n--;this.visible&&t.parent&&t.parent.refresh&&t.parent.refresh()},t.setSize=function(e,n){t.width=e,t.height=n,t.canvas.width=t.width,t.canvas.height=t.height,t.refresh()},t.setPosition=function(e,n){t.left=e,t.top=n,t.refresh()},t.setScale=function(e){t.scale=e,t.refresh()},t.moveTo=function(e,r,i,a){n&&(Y.screen.cancelAnimation(n),n=!1),i?n=Y.screen.registerAnimation({left:t.left,top:t.top},i,function(n,i){var a=(e-n.left)*i,o=(r-n.top)*i;t.setPosition(n.left+a,n.top+o)},a):t.setPosition(e,r)},t.scaleTo=function(e,n,r){i&&(Y.screen.cancelAnimation(i),i=!1),n?i=Y.screen.registerAnimation({scale:t.scale},n,function(n,r){var i=(e-n.scale)*r;t.setScale(n.scale+i)},r):t.setScale(e)},t.clipTo=function(e,n,i,a,o){r&&(Y.screen.cancelAnimation(r),r=!1),i?r=Y.screen.registerAnimation({width:t.width,height:t.height},i,function(r,i){var a=(e-r.width)*i,c=(n-r.height)*i;t.setSize(r.width+a,r.height+c),1==i&&o&&o()},a):t.setSize(e,n)},t.clearCanvas=function(){t.ctx.clearRect(0,0,t.width,t.height)},t},Yascal.panel=function(e){e=Y.properties(e);var t=Yascal.element(e);t.type="panel";var n=["left","top","width","height","name","type","zIndex","backgroundColor","backgroundImage"];return t.setProperties=function(e){n.forEach(function(n){"undefined"!=typeof e[n]&&(t[n]=e[n])}),t.setSize(t.width,t.height),t.setPosition(t.left,t.top),t.setLayout&&t.setLayout(t.left,t.top,t.width,t.height)},t.render=function(e){if(t.isVisible())return e=!!e,this.needsRendering&&(t.clearCanvas(),t.backgroundColor&&(t.ctx.fillStyle=t.backgroundColor,t.ctx.fillRect(0,0,t.width,t.height)),t.backgroundImage&&t.ctx.drawImage(t.backgroundImage,0,0,t.width,t.height),this.children.forEach(function(e){e.render()}),t.renderInternal&&t.renderInternal()),this.needsRendering=!1,e?t.canvas:void t.parentCtx.drawImage(t.canvas,t.left,t.top,t.width,t.height)},t.onClick=function(){},t.sortZIndex=function(){this.children.sort(function(e,t){return e.zIndex==t.zIndex?0:e.zIndex>t.zIndex||-1})},e&&t.setProperties(e),t},Yascal.listbox=function(e){function T(e){D=!0,s=e,d&&Y.screen.cancelAnimation(d),l||(g=i*I,v=g-(r.length-1)*I,l=Y.screen.registerAnimation(0,1/0,function(){u+=s,u=clamp(u,v,g);var e=s>0?1:-1,n=Math.abs(s);n<f&&(n+=p),s=e*n,t.refresh()}))}function L(){}function G(){var e=r.length-1;return t.centerSelection||(e=r.length-a),e}e=Y.properties(e);var t=Y.element(e);t.selectedIndex=0;var o,s,l,d,h,g,v,m,x,I,S,M,n=0,r=[],i=0,a=0,u=0,f=10,p=.2,w=2,E=DIRECTION.vertical,b=0,C=!1,D=!1;t.innerLeft=0,t.innerTop=0;var y=["left","top","width","height","name","type","onChange","selectedIndex","centerSelection","backgroundColor","renderFunction"];e.get("useScrollBar",!0);return t.setProperties=function(e){e=Y.properties(e),y.forEach(function(n){e.has(n)&&(t[n]=e[n])}),m=e.get("itemHeight",m),x=e.get("itemWidth",x),E=e.get("orientation",E),w=e.get("initialSpeed",w),p=e.get("acceleration",p),f=e.get("maxScrollSpeed",f),S=e.get("selectionWidth",S),M=e.get("selectionHeight",M),C=e.get("smoothDrag",C),t.setSize(t.width,t.height),t.setPosition(t.left,t.top),x||(x=t.width),m||(m=t.height),S||(S=x),M||(M=m),t.centerSelection&&(E==DIRECTION.horizontal?t.innerLeft=Math.ceil((t.width-x)/2):t.innerTop=Math.ceil((t.height-m)/2)),I=E==DIRECTION.horizontal?x:m},t.setSelectedIndex=function(e,r){t.selectedIndex=e,t.centerSelection&&(i=t.selectedIndex),t.refresh(),!r&&t.onChange&&n!=t.selectedIndex&&t.onChange(),n=t.selectedIndex},t.getSelectedIndex=function(){return t.selectedIndex},t.getSelectedItem=function(){return r[t.selectedIndex]},t.navigateUp=function(e){e?s<0||T(-w):(i>0&&(i--,L()),t.centerSelection?t.setSelectedIndex(i):t.refresh())},t.navigateDown=function(e){e?s>0||T(w):(i<G()&&(i++,L()),t.centerSelection?t.setSelectedIndex(i):t.refresh())},t.navigateLeft=t.navigateUp,t.navigateRight=t.navigateDown,t.stopNavigation=function(e){if(D){if(D=!1,l&&Y.screen.cancelAnimation(l),l=!1,u){var n=Math.floor(-u/I+i);u%I!=0&&s<0&&n++,n=clamp(n,0,r.length-1),t.moveToIndex(n)}s=0}},t.moveToIndex=function(e,n){e=clamp(e,0,r.length-1),l&&Y.screen.cancelAnimation(l),d&&Y.screen.cancelAnimation(d),s=0;var i=0-(e-t.selectedIndex)*I-u;d=Y.screen.registerAnimation(u,.5,function(r,a){u=r+i*a,1==a&&(u=0,t.setSelectedIndex(e),n&&n()),t.refresh()})},t.selectItem=function(){Y.screen.registerAnimation(1,.5,function(e,n){b=.4*(1-n),t.refresh()})},t.render=function(e){if(e=!!e,this.needsRendering){if(t.backgroundColor&&(t.ctx.fillStyle=t.backgroundColor,t.ctx.fillRect(0,0,t.width,t.height)),h&&h.render(),t.renderSelectionHighLight)t.renderSelectionHighLight(b);else{var n=t.innerLeft-(S-x)/2,a=t.innerTop-(M-m)/2;t.ctx.fillStyle="rgba(255,255,255,"+(.2+b)+")",t.ctx.fillRect(n,a,S,M)}for(var c=0,s=r.length;c<s;c++){var l=r[c],d=0,f=0;if(E==DIRECTION.horizontal?d=t.innerLeft+(c-i)*x+u:f=t.innerTop+(c-i)*m+u,f>-m&&f<t.height&&d>-x&&d<t.width)if(t.renderFunction)t.renderFunction(l,d,f);else{var g=10,v=10;l.level&&(g+=l.level*v),l.icon&&(t.ctx.drawImage(l.icon,g,f-2),g+=l.icon.width+4),t.ctx.fillStyle="white",t.ctx.fillText(l.label,g,f),f+=11}}o&&o.render()}return this.needsRendering=!1,e?t.canvas:void t.parentCtx.drawImage(t.canvas,t.left,t.top,t.width,t.height)},t.setItems=function(e){r=e,i=Math.min(i,G()+1),t.selectedIndex=0,L(),t.refresh()},t.getItems=function(){return r},t.getItemAtPosition=function(e,n,a){var o=0;return E==DIRECTION.horizontal?(e-=t.innerLeft,o=Math.floor(e/I)+i):(n-=t.innerTop,o=Math.floor(n/I)+i),o>=0&&o<r.length?a?o:r[o]:void 0},t.getItemIndexAtPosition=function(e,n){return t.getItemAtPosition(e,n,!0)},t.onMouseWheel=function(e){e.mouseWheels[0]>0?t.navigateUp():t.navigateDown()},t.onDragStart=function(e){t.startDragIndex=i},t.onDrag=function(e){var n;C?(n=E==DIRECTION.horizontal?e.dragX-e.startX:e.dragY-e.startY,u=n,t.refresh()):r.length>a&&(n=Math.round((e.dragY-e.startY)/m),i=t.startDragIndex-n,i=Math.max(i,0),i=Math.min(i,G()),t.centerSelection&&t.setSelectedIndex(i),L())},t.onDragEnd=function(e){if(Math.abs(u)>8){var n=Math.floor(-u/I+i);u%I!=0&&u<0&&n++,n=clamp(n,0,r.length-1),t.moveToIndex(n)}else t.onClick&&t.onClick(e)},t.setSelectionAlpha=function(e){b=e},t},Yascal.stats=function(e){var t=100,n=20,r=Yascal.element({width:t,height:n});return r.type="stats",r.backGroundColor="blue",r.render=function(t){if(r.isVisible()&&!Y.useWebGL)return t=!!t,this.needsRendering&&(r.clearCanvas(),r.backgroundColor&&(r.ctx.fillStyle=r.backgroundColor,r.ctx.fillRect(0,0,r.width,r.height)),e&&(r.ctx.fillStyle="white",r.ctx.font="16px Arial",r.ctx.fillText(e.stats(),10,16))),t?r.canvas:void r.parentCtx.drawImage(r.canvas,r.left,r.top,r.width,r.height)},r},Yascal.renderer=Yascal.renderer||{},Yascal.renderer.canvas2d=function(e,t){var n={},r=e.getContext("2d");return n.setSize=function(n,r){e.width=t.width=n,e.height=t.height=r},n.clear=function(){r.fillStyle=t.backGroundColor,r.clearRect(0,0,t.width,t.height),r.fillRect(0,0,t.width,t.height),t.backGroundImage&&r.drawImage(t.backGroundImage,0,0,t.width,t.height)},n},Yascal.renderer=Yascal.renderer||{},Yascal.renderer.webgl=function(e,t){var n={};return n.setSize=function(t,n){e.resize(t,n)},n.clear=function(){var n=e.gl;n.clear(n.COLOR_BUFFER_BIT),t.backGroundImage},n};