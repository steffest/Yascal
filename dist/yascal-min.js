var Yascal=function(){var e={};return e.init=function(t){e.screen.init(t),e.touchInput.init(e.canvas)},e.sprites={},e.getImage=function(t){return e.sprites[t]?e.sprites[t].canvas:void 0},e.loadImage=function(e,t){var n=new Image;n.onload=function(){t&&t(n)},n.onerror=function(){},n.src=e},e.getModalElement=function(){},e.getEventElement=function(t,n){for(var i=void 0,r=0,o=e.screen.children.length;r<o;r++){var a=e.screen.children[r];if(a.isVisible()&&a.containsPoint(t,n)){i=a;break}}return i&&i.children&&i.children.length&&(i=i.getElementAtPoint(t,n)),i},e}(),Y=Yascal;Yascal.properties=function(e){if(e&&e.isYascal)return e;var t=e||{};return t.isYascal=!0,t.get=function(e,n){return"undefined"==typeof t[e]?n:t[e]},t.set=function(e,n){t[e]=n},t.has=function(e){return"undefined"!=typeof t[e]},t},Yascal.screen=function(e){var t={};e=Y.properties(e),t.name="mainScreen",t.visible=!0,t.children=[];var r,o,c,d,n=[],i={},a=!0,s=1,u=1,h="black";return t.init=function(){r=e.canvas||document.createElement("canvas"),o=r.getContext("2d"),Y.canvas=t.canvas=r,Y.ctx=t.ctx=o,t.render()},t.setSize=function(e,n){r.width=t.width=e,r.height=t.height=n},t.setScaleFactor=function(e){s=r.offsetWidth/r.width,u=r.offsetHeight/r.height,e&&window.addEventListener("resize",function(){t.setScaleFactor()},!0)},t.getScaleFactor=function(){return{width:s,height:u}},t.windowToCanvas=function(e,t){return{x:e/s,y:t/u}},t.canvasToWindow=function(e,t){return{x:e*s,y:t*u}},t.scaledX=function(e){return Math.round(e/s)},t.scaledY=function(e){return Math.round(e/u)},t.setProperties=function(e){e=Y.properties(e),h=e.get("backGroundColor",h),d=e.get("backGroundImage",d)},t.clear=function(){o.fillStyle=h,o.clearRect(0,0,t.width,t.height),o.fillRect(0,0,t.width,t.height),d&&o.drawImage(d,0,0,t.width,t.height)},t.clearBackGroundImage=function(){d=void 0},t.refresh=function(){a=!0},t.addChild=function(e){e.setParent(t),e.zIndex=e.zIndex||t.children.length,t.children.push(e),a=!0},t.render=function(){var e=!0;if(e){var r=performance.now();n.forEach(function(e,t){if(e.canceled)delete i[e.id],n.splice(t,1);else{var o=r-e.start,c=Math.min(o/e.duration,1),s=e.easing||Yascal.easing.easeOutQuad,u=s(c);e.updatefunction(e.initialState,u),a=!0,1==c&&n.splice(t,1)}}),a&&(t.clear(),t.children.forEach(function(e){e.render()}),c&&(c.render(),a=!1),a=!1)}window.requestAnimationFrame(t.render)},t.registerAnimation=function(e,t,r,o){if(t){var a={id:generateUUID(),start:performance.now(),duration:1e3*t,easing:o,initialState:e,updatefunction:r};return n.push(a),i[a.id]=a,a.id}return!1},t.cancelAnimation=function(e){var t=i[e];t&&(t.canceled=!0)},t}(),Yascal.sprite=function(e){var t={};if(t.canvas=document.createElement("canvas"),t.ctx=t.canvas.getContext("2d"),e&&(e.width&&(t.canvas.width=e.width,t.canvas.height=e.height||e.width),e.img)){var n=e.x||0,i=e.y||0,r=t.canvas.width,o=t.canvas.height;t.ctx.drawImage(e.img,n,i,r,o,0,0,r,o)}return t},Yascal.easing=function(){var e={};return e.linear=function(e){return e},e.easeInSine=function(e){return-1*Math.cos(e*(Math.PI/2))+1},e.easeOutSine=function(e){return Math.sin(e*(Math.PI/2))},e.easeInOutSine=function(e){return-.5*(Math.cos(Math.PI*e)-1)},e.easeInQuad=function(e){return e*e},e.easeOutQuad=function(e){return e*(2-e)},e.easeInOutQuad=function(e){return.5>e?2*e*e:-1+(4-2*e)*e},e.easeInCubic=function(e){return e*e*e},e.easeOutCubic=function(e){var t=e-1;return t*t*t+1},e.easeOutQuint=function(e){var t=e-1;return 1+t*t*t*t*t},e.easeOutCirc=function(e){var t=e-1;return Math.sqrt(1-t*t)},e.easeOutElastic=function(e){var t=arguments.length<=1||void 0===arguments[1]?.7:arguments[1],n=1-t,i=2*e;if(0===e||1===e)return e;var r=n/(2*Math.PI)*Math.asin(1);return Math.pow(2,-10*i)*Math.sin((i-r)*(2*Math.PI)/n)+1},e.easeOutBounce=function(e){var t=e/1;if(1/2.75>t)return 7.5625*t*t;if(2/2.75>t){var n=t-1.5/2.75;return 7.5625*n*n+.75}if(2.5/2.75>t){var i=t-2.25/2.75;return 7.5625*i*i+.9375}var r=t-2.625/2.75;return 7.5625*r*r+.984375},e.easeInOutBounce=function(e){return.5>e?.5*_(2*e):.5*easeOutBounce(2*e-1)+.5},e}(),Yascal.keyInput=function(){function n(e){var n=e.keyCode;t[n]=o(n),t[n].isDown=!0,n!=KEY.space&&n!=KEY.ctrl&&n!=KEY.enter||(t[KEY.action]=o(KEY.action),t[KEY.action].isDown=!0),"undefined"!=typeof EventBus&&EventBus.trigger(EVENT.keyDown,n)}function i(e){var n=e.keyCode;t[n]=o(n),t[n].isDown=!1,n!=KEY.space&&n!=KEY.ctrl&&n!=KEY.enter||(t[KEY.action]=o(KEY.action),t[KEY.action].isDown=!1),"undefined"!=typeof EventBus&&EventBus.trigger(EVENT.keyUp,n)}function o(e){return t[e]||{}}var e={},t={};return document.addEventListener("keydown",n,!1),document.addEventListener("keyup",i,!1),e.isDown=function(t){return e.isKeyDown(KEY.down,t)},e.isUp=function(t){return e.isKeyDown(KEY.up,t)},e.isLeft=function(t){return e.isKeyDown(KEY.left,t)},e.isRight=function(t){return e.isKeyDown(KEY.right,t)},e.isAction=function(t){return e.isKeyDown(KEY.action,t)},e.isEnter=function(t){return e.isKeyDown(KEY.enter,t)},e.isKeyDown=function(e,n){return t[e]=o(e),"undefined"!=typeof n&&(t[e].isDown=n),t[e].isDown},e}(),Yascal.touchInput=function(){function r(e){function s(e,n,r){t.isTouchDown=!0;var o=i.getBoundingClientRect();n=Y.screen.scaledX(n-o.left),r=Y.screen.scaledY(r-o.top),currentEventTarget=Y.getModalElement()||Y.getEventElement(n,r);var a={id:e,x:n,y:r,startX:n,startY:r,UIobject:currentEventTarget};t.touches.push(a),a.UIobject&&(a.UIobject.onDragStart&&a.UIobject.onDragStart(a),a.UIobject.onTouchDown&&a.UIobject.onTouchDown(a))}if(e.preventDefault(),n||(n=!0),e.touches&&e.touches.length>0)for(var r=e.changedTouches,o=0;o<r.length;o++){var a=r[o];s(a.identifier,a.pageX,a.pageY)}else{var c=d("notouch");c>=0&&t.touches.splice(c,1),s("notouch",e.pageX,e.pageY)}}function o(e){function l(e,n,i){if(e>=0){var r=t.touches[e];r.x=n,r.y=i,t.touches.splice(e,1,r),t.isTouchDown&&r.UIobject&&r.UIobject.onDrag&&(r.dragX=n,r.dragY=i,r.isDragging=!0,r.UIobject.onDrag(r))}}e.preventDefault();var o,a,n=i.getBoundingClientRect();if(e.touches&&e.touches.length>0)for(var c=e.changedTouches,s=0;s<c.length;s++){var u=c[s];o=Y.screen.scaledX(u.pageX-n.left),a=Y.screen.scaledY(u.pageY-n.top),l(d(u.identifier),o,a)}else if(o=Y.screen.scaledX(e.pageX-n.left),a=Y.screen.scaledY(e.pageY-n.top),l(d("notouch"),o,a),t.currentMouseX=o,t.currentMouseY=a,t.mouseMoved=(new Date).getTime(),SETTINGS.useHover){var h=UI.getEventElement(o,a);h&&h.onHover&&h.onHover(t),prevHoverTarget&&prevHoverTarget!=h&&prevHoverTarget.onHoverExit&&prevHoverTarget.onHoverExit(t,h),prevHoverTarget=h}}function a(e){function o(e){if(e>=0){var n=t.touches[e];if(n.UIobject){var i=n.UIobject;if(i.onClick){var r=n.startX-n.x,o=n.startY-n.y,a=Math.sqrt(r*r+o*o);a<8&&i.onClick(n)}i.onDragEnd&&i.onDragEnd(n),i.onTouchUp&&i.onTouchUp(n)}t.touches.splice(e,1)}}function a(){}if(t.isTouchDown=!1,e&&e.touches){for(var n=e.changedTouches,i=0;i<n.length;i++){var r=n[i];o(d(r.identifier))}0==e.touches.length&&a()}else o(d("notouch")),a()}function c(e){if(t.currentMouseX){var n=t.currentMouseX,i=t.currentMouseY,r=Y.getEventElement(n,i);if(r&&r.onMouseWheel){var o=e.wheelDeltaY||e.wheelDelta||-e.detail;e.wheelDeltaX||0;t.mouseWheels.unshift(o),t.mouseWheels.length>10&&t.mouseWheels.pop(),r.onMouseWheel(t)}}}function s(e){e.stopPropagation(),e.preventDefault()}function u(e){e.stopPropagation(),e.preventDefault()}function h(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer,n=t.files;Tracker.handleUpload(n)}var e={},t={};t.touches=[],t.mouseWheels=[];var i,n=!1;e.init=function(e){i=e,i.addEventListener("mousedown",r,!1),i.addEventListener("mousemove",o,!1),i.addEventListener("mouseup",a,!1),i.addEventListener("touchstart",r,!1),i.addEventListener("touchmove",o,!1),i.addEventListener("touchend",a,!1),window.navigator.msPointerEnabled&&(i.addEventListener("MSPointerDown",r,!1),i.addEventListener("MSPointerMove",o,!1),i.addEventListener("MSPointerEnd",a,!1)),i.addEventListener("mousewheel",c,!1),i.addEventListener("DOMMouseScroll",c,!1),i.addEventListener("dragenter",s,!1),i.addEventListener("dragover",u,!1),i.addEventListener("drop",h,!1)};var d=function(e){for(var n=0;n<t.touches.length;n++)if(t.touches[n].id===e)return n;return-1};return e}(),Yascal.element=function(e){var t={};e=e||{},t.left=e.left||0,t.top=e.top||0,t.width=e.width||20,t.height=e.height||20,t.visible=!0,t.needsRendering=!0,t.parentCtx=Y.ctx,t.canvas=document.createElement("canvas"),t.canvas.width=t.width,t.canvas.height=t.height,t.ctx=t.canvas.getContext("2d"),t.children=[],t.id=generateUUID();var n,i;return t.hide=function(e){t.visible=!1,e&&t.refresh()},t.show=function(e,n){t.visible=!0,e&&t.refresh(n)},t.toggle=function(){t.visible?t.hide():t.show()},t.isVisible=function(){for(var e=t.visible,n=t.parent;e&&n;)e=n.visible,n=n.parent;return e},t.containsPoint=function(e,t){var n=this.left,i=this.left+this.width,r=this.top,o=this.top+this.height;return e>=n&&e<=i&&t>=r&&t<=o},t.getElementAtPoint=function(e,n){e-=t.left,n-=t.top;for(var i,r=t.children.length-1;r>=0;r--){var o=t.children[r];if(o.isVisible()&&!o.ignoreEvents&&o.containsPoint(e,n)){i=o;break}}if(i){var a=i.getElementAtPoint(e,n);a?i=a:(i.eventX=e,i.eventY=n)}else i=t,i.eventX=e,i.eventY=n;return i},t.setParent=function(e){t.parent=e,e&&(t.parentCtx=e.ctx)},t.addChild=function(e){e.setParent(t),e.zIndex=e.zIndex||t.children.length,t.children.push(e)},t.getChild=function(e){for(var i,n=t.children.length;n;){if(i=t.children[n],i&&i.name&&i.name==e)return i;n--}},t.refresh=function(e){if(t.needsRendering=!0,e)for(var i,n=t.children.length;n;)i=t.children[n],i&&i.refresh(),n--;this.visible&&t.parent&&t.parent.refresh&&t.parent.refresh()},t.setSize=function(e,n){t.width=e,t.height=n,t.canvas.width=t.width,t.canvas.height=t.height,t.refresh()},t.setPosition=function(e,n){t.left=e,t.top=n,t.refresh()},t.moveTo=function(e,i,r,o){n&&(Y.screen.cancelAnimation(n),n=!1),r?n=Y.screen.registerAnimation({left:t.left,top:t.top},r,function(n,r){var o=(e-n.left)*r,a=(i-n.top)*r;t.setPosition(n.left+o,n.top+a)},o):t.setPosition(e,i)},t.clipTo=function(e,n,r,o,a){i&&(Y.screen.cancelAnimation(i),i=!1),r?i=Y.screen.registerAnimation({width:t.width,height:t.height},r,function(i,r){var o=(e-i.width)*r,c=(n-i.height)*r;t.setSize(i.width+o,i.height+c),1==r&&a&&a()},o):t.setSize(e,n)},t.clearCanvas=function(){t.ctx.clearRect(0,0,t.width,t.height)},t},Yascal.panel=function(e){e=Y.properties(e);var t=Yascal.element(e);t.type="panel";var n=["left","top","width","height","name","type","zIndex","backgroundColor","backgroundImage"];return t.setProperties=function(e){n.forEach(function(n){"undefined"!=typeof e[n]&&(t[n]=e[n])}),t.setSize(t.width,t.height),t.setPosition(t.left,t.top),t.setLayout&&t.setLayout(t.left,t.top,t.width,t.height)},t.render=function(e){if(t.isVisible())return e=!!e,this.needsRendering&&(t.clearCanvas(),t.backgroundColor&&(t.ctx.fillStyle=t.backgroundColor,t.ctx.fillRect(0,0,t.width,t.height)),t.backgroundImage&&t.ctx.drawImage(t.backgroundImage,0,0,t.width,t.height),this.children.forEach(function(e){e.render()}),t.renderInternal&&t.renderInternal()),this.needsRendering=!1,e?t.canvas:void t.parentCtx.drawImage(t.canvas,t.left,t.top,t.width,t.height)},t.onClick=function(){},t.sortZIndex=function(){this.children.sort(function(e,t){return e.zIndex==t.zIndex?0:e.zIndex>t.zIndex||-1})},e&&t.setProperties(e),t},Yascal.listbox=function(e){function P(e){T=!0,s=e,d&&Y.screen.cancelAnimation(d),h||(g=r*E,v=g-(i.length-1)*E,h=Y.screen.registerAnimation(0,1/0,function(){u+=s,u=clamp(u,v,g);var e=s>0?1:-1,n=Math.abs(s);n<f&&(n+=p),s=e*n,t.refresh()}))}function k(){}function L(){var e=i.length-1;return t.centerSelection||(e=i.length-o),e}e=Y.properties(e);var t=Y.element(e);t.selectedIndex=0;var a,s,h,d,l,g,v,I,w,E,S,b,n=0,i=[],r=0,o=0,u=0,f=10,p=.2,m=2,x=DIRECTION.vertical,D=0,M=!1,T=!1;t.innerLeft=0,t.innerTop=0;var C=["left","top","width","height","name","type","onChange","selectedIndex","centerSelection","backgroundColor","renderFunction"];e.get("useScrollBar",!0);return t.setProperties=function(e){e=Y.properties(e),C.forEach(function(n){e.has(n)&&(t[n]=e[n])}),I=e.get("itemHeight",I),w=e.get("itemWidth",w),x=e.get("orientation",x),m=e.get("initialSpeed",m),p=e.get("acceleration",p),f=e.get("maxScrollSpeed",f),S=e.get("selectionWidth",S),b=e.get("selectionHeight",b),M=e.get("smoothDrag",M),t.setSize(t.width,t.height),t.setPosition(t.left,t.top),w||(w=t.width),I||(I=t.height),S||(S=w),b||(b=I),t.centerSelection&&(x==DIRECTION.horizontal?t.innerLeft=Math.ceil((t.width-w)/2):t.innerTop=Math.ceil((t.height-I)/2)),E=x==DIRECTION.horizontal?w:I},t.setSelectedIndex=function(e,i){t.selectedIndex=e,t.centerSelection&&(r=t.selectedIndex),t.refresh(),!i&&t.onChange&&n!=t.selectedIndex&&t.onChange(),n=t.selectedIndex},t.getSelectedIndex=function(){return t.selectedIndex},t.getSelectedItem=function(){return i[t.selectedIndex]},t.navigateUp=function(e){e?s<0||P(-m):(r>0&&(r--,k()),t.centerSelection?t.setSelectedIndex(r):t.refresh())},t.navigateDown=function(e){e?s>0||P(m):(r<L()&&(r++,k()),t.centerSelection?t.setSelectedIndex(r):t.refresh())},t.navigateLeft=t.navigateUp,t.navigateRight=t.navigateDown,t.stopNavigation=function(e){if(T){if(T=!1,h&&Y.screen.cancelAnimation(h),h=!1,u){var n=Math.floor(-u/E+r);u%E!=0&&s<0&&n++,n=clamp(n,0,i.length-1),t.moveToIndex(n)}s=0}},t.moveToIndex=function(e,n){e=clamp(e,0,i.length-1),h&&Y.screen.cancelAnimation(h),d&&Y.screen.cancelAnimation(d),s=0;var r=0-(e-t.selectedIndex)*E-u;d=Y.screen.registerAnimation(u,.5,function(i,o){u=i+r*o,1==o&&(u=0,t.setSelectedIndex(e),n&&n()),t.refresh()})},t.selectItem=function(){Y.screen.registerAnimation(1,.5,function(e,n){D=.4*(1-n),t.refresh()})},t.render=function(e){if(e=!!e,this.needsRendering){if(t.backgroundColor&&(t.ctx.fillStyle=t.backgroundColor,t.ctx.fillRect(0,0,t.width,t.height)),l&&l.render(),t.renderSelectionHighLight)t.renderSelectionHighLight(D);else{var n=t.innerLeft-(S-w)/2,o=t.innerTop-(b-I)/2;t.ctx.fillStyle="rgba(255,255,255,"+(.2+D)+")",t.ctx.fillRect(n,o,S,b)}for(var c=0,s=i.length;c<s;c++){var h=i[c],d=0,f=0;if(x==DIRECTION.horizontal?d=t.innerLeft+(c-r)*w+u:f=t.innerTop+(c-r)*I+u,f>-I&&f<t.height&&d>-w&&d<t.width)if(t.renderFunction)t.renderFunction(h,d,f);else{var g=10,v=10;h.level&&(g+=h.level*v),h.icon&&(t.ctx.drawImage(h.icon,g,f-2),g+=h.icon.width+4),t.ctx.fillStyle="white",t.ctx.fillText(h.label,g,f),f+=11}}a&&a.render()}return this.needsRendering=!1,e?t.canvas:void t.parentCtx.drawImage(t.canvas,t.left,t.top,t.width,t.height)},t.setItems=function(e){i=e,r=Math.min(r,L()+1),t.selectedIndex=0,k(),t.refresh()},t.getItems=function(){return i},t.getItemAtPosition=function(e,n,o){var a=0;return x==DIRECTION.horizontal?(e-=t.innerLeft,a=Math.floor(e/E)+r):(n-=t.innerTop,a=Math.floor(n/E)+r),a>=0&&a<i.length?o?a:i[a]:void 0},t.getItemIndexAtPosition=function(e,n){return t.getItemAtPosition(e,n,!0)},t.onMouseWheel=function(e){e.mouseWheels[0]>0?t.navigateUp():t.navigateDown()},t.onDragStart=function(e){t.startDragIndex=r},t.onDrag=function(e){var n;M?(n=x==DIRECTION.horizontal?e.dragX-e.startX:e.dragY-e.startY,u=n,t.refresh()):i.length>o&&(n=Math.round((e.dragY-e.startY)/I),r=t.startDragIndex-n,r=Math.max(r,0),r=Math.min(r,L()),t.centerSelection&&t.setSelectedIndex(r),k())},t.onDragEnd=function(e){if(Math.abs(u)>8){var n=Math.floor(-u/E+r);u%E!=0&&u<0&&n++,n=clamp(n,0,i.length-1),t.moveToIndex(n)}else t.onClick&&t.onClick(e)},t.setSelectionAlpha=function(e){D=e},t};