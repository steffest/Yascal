var YascalGl=function(){var e={};return e}(),YGL=YascalGl;YascalGl.context=function(e,t,r,n){function a(){i.valid=!1;try{i.gl=i.view.getContext("webgl",i.contextAttributes)||i.view.getContext("experimental-webgl",i.contextAttributes)}catch(e){i.gl=null}i.gl&&(i.valid=!0)}function o(e){i.valid=!1}function l(e){a();for(var t=0;t<i.managedObjects.length;t++){var r=i.managedObjects[t];r&&"function"==typeof r.create&&r.create()}i.resize(i.width,i.height)}var i={};return i.managedObjects=[],i.gl=null,i.valid=!1,r&&"undefined"!=typeof window.WebGLRenderingContext&&r instanceof window.WebGLRenderingContext&&(r=r.canvas,i.gl=r,i.valid=!0,n=void 0),i.view=r||document.createElement("canvas"),i.width=i.view.width=e||300,i.height=i.view.height=t||150,i.contextAttributes=n,i.resize=function(e,t){i.width=i.view.width=e,i.height=i.view.height=t,i.gl.viewport(0,0,e,t)},i.view.addEventListener("webglcontextlost",function(e){e.preventDefault(),o(e)}.bind(i)),i.view.addEventListener("webglcontextrestored",function(e){e.preventDefault(),l(e)}.bind(i)),i.valid||a(),i.resize(i.width,i.height),i.addManagedObject=function(e){i.managedObjects.push(e)},i.removeManagedObject=function(e){var t=i.managedObjects.indexOf(e);if(t>-1)return i.managedObjects.splice(t,1),e},i.destroy=function(){for(var e=0;e<i.managedObjects.length;e++){var t=i.managedObjects[e];t&&"function"==typeof t.destroy&&t.destroy()}i.managedObjects.length=0,i.valid=!1,i.gl=null,i.view=null,i.width=i.height=0},i};var TEXTURE={wrap:{CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},filter:{NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985},format:{DEPTH_COMPONENT:6402,ALPHA:6406,RGBA:6408,RGB:6407,LUMINANCE:6409,LUMINANCE_ALPHA:6410},dataType:{BYTE:5120,SHORT:5122,INT:5124,FLOAT:5126,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635},FORCE_POT:!1,UNPACK_FLIP_Y:!1,UNPACK_ALIGNMENT:1,UNPACK_PREMULTIPLY_ALPHA:!0,UNPACK_COLORSPACE_CONVERSION:void 0,USE_DUMMY_1x1_DATA:!0};TEXTURE.DEFAULT_WRAP=TEXTURE.wrap.CLAMP_TO_EDGE,TEXTURE.DEFAULT_FILTER=TEXTURE.filter.NEAREST,TEXTURE.getNumComponents=function(e){switch(e){case TEXTURE.format.DEPTH_COMPONENT:case TEXTURE.format.ALPHA:case TEXTURE.format.LUMINANCE:return 1;case TEXTURE.format.LUMINANCE_ALPHA:return 2;case TEXTURE.format.RGB:return 3;case TEXTURE.format.RGBA:return 4}return null},YascalGl.texture=function(e,t,r,n,i,a,o){function u(){if(!TEXTURE.FORCE_POT){var e=l.minFilter!==TEXTURE.filter.LINEAR&&l.minFilter!==TEXTURE.filter.NEAREST,t=l.wrapS!==TEXTURE.wrap.CLAMP_TO_EDGE||l.wrapT!==TEXTURE.wrap.CLAMP_TO_EDGE;if((e||t)&&(!isPowerOfTwo(l.width)||!isPowerOfTwo(l.height)))throw new Error(e?"Non-power-of-two textures cannot use mipmapping as filter":"Non-power-of-two textures must use CLAMP_TO_EDGE as wrap")}}var l={};if("object"!=typeof e)throw"please prove a GL context";return l.context=e,l.id=null,l.target=e.gl.TEXTURE_2D,l.width=0,l.height=0,l.wrapS=TEXTURE.DEFAULT_WRAP,l.wrapT=TEXTURE.DEFAULT_WRAP,l.minFilter=TEXTURE.DEFAULT_FILTER,l.magFilter=TEXTURE.DEFAULT_FILTER,l.managedArgs=Array.prototype.slice.call(arguments,1),l.context.addManagedObject(l),l.bind=function(e){(e||0===e)&&l.gl.activeTexture(l.gl.TEXTURE0+e),l.gl.bindTexture(l.target,l.id)},l.toString=function(){return l.id+":"+l.width+"x"+l.height},l.setWrap=function(e,t,r){e&&t?(l.wrapS=e,l.wrapT=t):l.wrapS=l.wrapT=e,u(),r||l.bind();var n=l.gl;n.texParameteri(l.target,n.TEXTURE_WRAP_S,l.wrapS),n.texParameteri(l.target,n.TEXTURE_WRAP_T,l.wrapT)},l.setFilter=function(e,t,r){e&&t?(l.minFilter=e,l.magFilter=t):l.minFilter=l.magFilter=e,u(),r||l.bind();var n=this.gl;n.texParameteri(l.target,n.TEXTURE_MIN_FILTER,l.minFilter),n.texParameteri(l.target,n.TEXTURE_MAG_FILTER,l.magFilter)},l.create=function(){l.gl=l.context.gl;var e=l.gl;l.id=e.createTexture(),l.width=l.height=0,l.target=e.TEXTURE_2D,l.bind(),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,TEXTURE.UNPACK_PREMULTIPLY_ALPHA),e.pixelStorei(e.UNPACK_ALIGNMENT,TEXTURE.UNPACK_ALIGNMENT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,TEXTURE.UNPACK_FLIP_Y);var t=TEXTURE.UNPACK_COLORSPACE_CONVERSION||e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,t),l.setWrap(l.wrapS,l.wrapT,!1),l.setFilter(l.minFilter,l.magFilter,!1),0!==l.managedArgs.length&&l.setup.apply(this,l.managedArgs)},l.destroy=function(){l.id&&l.gl&&l.gl.deleteTexture(l.id),l.context&&l.context.removeManagedObject(l),l.width=l.height=0,l.id=null,l.managedArgs=null,l.context=null,l.gl=null},l.uploadData=function(e,t,r,n,i,a){var o=l.gl;r=r||o.RGBA,n=n||o.UNSIGNED_BYTE,i=i||null,l.width=e||0==e?e:l.width,l.height=t||0==t?t:l.height,u(),l.bind(),o.texImage2D(l.target,0,r,l.width,l.height,0,r,n,i),a&&o.generateMipmap(l.target)},l.uploadImage=function(e,t,r,n){var i=l.gl;t=t||i.RGBA,r=r||i.UNSIGNED_BYTE,l.width=e.width,l.height=e.height,u(),l.bind(),i.texImage2D(l.target,0,t,t,r,e),n&&i.generateMipmap(l.target)},l.setup=function(e,t,r,n,i,a){var o=l.gl;if("string"==typeof e){var u=new Image,c=arguments[0],d="function"==typeof arguments[1]?arguments[1]:null,f="function"==typeof arguments[2]?arguments[2]:null;a=!!arguments[3];TEXTURE.USE_DUMMY_1x1_DATA&&(l.uploadData(1,1),l.width=l.height=0),u.onload=function(){l.uploadImage(u,void 0,void 0,a),d&&d()},u.onerror=function(){a&&o.generateMipmap(o.TEXTURE_2D),f&&f()},u.onabort=function(){a&&o.generateMipmap(o.TEXTURE_2D),f&&f()},u.src=c}else this.uploadData(e,t,r,n,i,a)},l.create(),l},YascalGl.textureRegion=function(e,t,r,n,i){var a={};return a.width=0,a.height=0,a.u=0,a.v=0,a.u2=0,a.v2=0,a.texture=e,a.setUVs=function(e,t,r,n){a.width=Math.round(Math.abs(r-e)*a.texture.width),a.height=Math.round(Math.abs(n-t)*a.texture.height),a.u=e,a.v=t,a.u2=r,a.v2=n},a.setRegion=function(e,t,r,n){e=e||0,t=t||0,r="number"==typeof r?r:a.texture.width,n="number"==typeof n?n:a.texture.height;var i=1/a.texture.width,o=1/a.texture.height;a.setUVs(e*i,t*o,(e+r)*i,(t+n)*o),a.width=Math.abs(r),a.height=Math.abs(n)},a.setRegion(t,r,n,i),Object.defineProperty(a,"x",{get:function(){return Math.round(a.u*a.texture.width)}}),Object.defineProperty(a,"y",{get:function(){return Math.round(a.v*a.texture.height)}}),a};var int8=new Int8Array(4),int32=new Int32Array(int8.buffer,0,1),float32=new Float32Array(int8.buffer,0,1);YascalGl.numberUtil=function(){var e={};return e.intBitsToFloat=function(e){return int32[0]=e,float32[0]},e.floatToIntBits=function(e){return float32[0]=e,int32[0]},e.intToFloatColor=function(t){return e.intBitsToFloat(4278190079&t)},e.colorToFloat=function(t,r,n,i){var a=i<<24|n<<16|r<<8|t;return e.intToFloatColor(a)},e.isPowerOfTwo=function(e){return 0==(e&e-1)},e.nextPowerOfTwo=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e+1},e}(),YascalGl.shaderProgram=function(e,t,r,n){var i={};if(!t||!r)throw"vertex and fragment shaders must be defined";if("object"!=typeof e)throw"GL context not specified to ShaderProgram";return i.context=e,i.vertShader=null,i.fragShader=null,i.program=null,i.log="",i.uniformCache=null,i.attributeCache=null,i.attributeLocations=n,i.vertSource=t.trim(),i.fragSource=r.trim(),i.context.addManagedObject(i),i.create=function(){i.gl=i.context.gl,i._compileShaders()},i._compileShaders=function(){var e=i.gl;if(i.log="",i.vertShader=i._loadShader(e.VERTEX_SHADER,i.vertSource),i.fragShader=i._loadShader(e.FRAGMENT_SHADER,i.fragSource),!i.vertShader||!i.fragShader)throw"Error returned when calling createShader";if(i.program=e.createProgram(),e.attachShader(i.program,i.vertShader),e.attachShader(i.program,i.fragShader),i.attributeLocations)for(var t in i.attributeLocations)i.attributeLocations.hasOwnProperty(t)&&e.bindAttribLocation(i.program,Math.floor(i.attributeLocations[t]),t);if(e.linkProgram(i.program),i.log+=e.getProgramInfoLog(i.program)||"",!e.getProgramParameter(i.program,e.LINK_STATUS))throw"Error linking the shader program:\n"+i.log;i._fetchUniforms(),i._fetchAttributes()},i._fetchUniforms=function(){var e=i.gl;i.uniformCache={};var t=e.getProgramParameter(i.program,e.ACTIVE_UNIFORMS);if(t)for(var r=0;r<t;r++){var n=e.getActiveUniform(i.program,r);if(null!==n){var a=n.name,o=e.getUniformLocation(i.program,a);i.uniformCache[a]={size:n.size,type:n.type,location:o}}}},i._fetchAttributes=function(){var e=i.gl;i.attributeCache={};var t=e.getProgramParameter(i.program,e.ACTIVE_ATTRIBUTES);if(t)for(var r=0;r<t;r++){var n=e.getActiveAttrib(i.program,r);if(null!==n){var a=n.name,o=e.getAttribLocation(i.program,a);i.attributeCache[a]={size:n.size,type:n.type,location:o}}}},i._loadShader=function(e,t){var r=i.gl,n=r.createShader(e);if(!n)return-1;r.shaderSource(n,t),r.compileShader(n);var a=r.getShaderInfoLog(n)||"";if(a){var o=e===r.VERTEX_SHADER?"vertex":"fragment";a="Error compiling "+o+" shader:\n"+a}if(i.log+=a,!r.getShaderParameter(n,r.COMPILE_STATUS))throw i.log;return n},i.bind=function(){i.gl.useProgram(i.program)},i.destroy=function(){if(i.context&&i.context.removeManagedObject(i),i.gl&&i.program){var e=i.gl;e.detachShader(i.program,i.vertShader),e.detachShader(i.program,i.fragShader),e.deleteShader(i.vertShader),e.deleteShader(i.fragShader),e.deleteProgram(i.program)}i.attributeCache=null,i.uniformCache=null,i.vertShader=null,i.fragShader=null,i.program=null,i.gl=null,i.context=null},i.getUniformInfo=function(e){return i.uniformCache[e]||null},i.getAttributeInfo=function(e){return i.attributeCache[e]||null},i.getAttributeLocation=function(e){var t=i.getAttributeInfo(e);return t?t.location:null},i.getUniformLocation=function(e){var t=i.getUniformInfo(e);return t?t.location:null},i.hasUniform=function(e){return null!==i.getUniformInfo(e)},i.hasAttribute=function(e){return null!==i.getAttributeInfo(e)},i.getUniform=function(e){return i.gl.getUniform(i.program,i.getUniformLocation(e))},i.getUniformAt=function(e){return i.gl.getUniform(i.program,e)},i.setUniformi=function(e,t,r,n,a){"use strict";var o=i.gl,l=i.getUniformLocation(e);if(null===l)return!1;switch(arguments.length){case 2:return o.uniform1i(l,t),!0;case 3:return o.uniform2i(l,t,r),!0;case 4:return o.uniform3i(l,t,r,n),!0;case 5:return o.uniform4i(l,t,r,n,a),!0;default:throw"invalid arguments to setUniformi"}},i.setUniformf=function(e,t,r,n,a){"use strict";var o=i.gl,l=i.getUniformLocation(e);if(null===l)return!1;switch(arguments.length){case 2:return o.uniform1f(l,t),!0;case 3:return o.uniform2f(l,t,r),!0;case 4:return o.uniform3f(l,t,r,n),!0;case 5:return o.uniform4f(l,t,r,n,a),!0;default:throw"invalid arguments to setUniformf"}},i.setUniformfv=function(e,t,r){"use strict";r=r||t.length;var n=i.gl,a=i.getUniformLocation(e);if(null===a)return!1;switch(r){case 1:return n.uniform1fv(a,t),!0;case 2:return n.uniform2fv(a,t),!0;case 3:return n.uniform3fv(a,t),!0;case 4:return n.uniform4fv(a,t),!0;default:throw"invalid arguments to setUniformf"}},i.setUniformiv=function(e,t,r){"use strict";r=r||t.length;var n=i.gl,a=i.getUniformLocation(e);if(null===a)return!1;switch(r){case 1:return n.uniform1iv(a,t),!0;case 2:return n.uniform2iv(a,t),!0;case 3:return n.uniform3iv(a,t),!0;case 4:return n.uniform4iv(a,t),!0;default:throw"invalid arguments to setUniformf"}},i.setUniformMatrix3=function(e,t,r){"use strict";var n="object"==typeof t&&t.val?t.val:t;r=!!r;var a=i.gl,o=i.getUniformLocation(e);return null!==o&&void a.uniformMatrix3fv(o,r,n)},i.setUniformMatrix4=function(e,t,r){"use strict";var n="object"==typeof t&&t.val?t.val:t;r=!!r;var a=i.gl,o=i.getUniformLocation(e);return null!==o&&void a.uniformMatrix4fv(o,r,n)},i.create(),i},YascalGl.mesh=function(e,t,r,n,i){var a={};if(a.dirty={set:function(e){a.verticesDirty=e,a.indicesDirty=e}},"object"!=typeof e)throw"GL context not specified to Mesh";if(!r)throw"numVerts not specified, must be > 0";a.context=e,a.gl=e.gl,a.numVerts=null,a.numIndices=null,a.vertices=null,a.indices=null,a.vertexBuffer=null,a.indexBuffer=null,a.verticesDirty=!0,a.indicesDirty=!0,a.indexUsage=null,a.vertexUsage=null,a._vertexAttribs=null,a.vertexStride=null,a.numVerts=r,a.numIndices=n||0,a.vertexUsage=t?a.gl.STATIC_DRAW:a.gl.DYNAMIC_DRAW,a.indexUsage=t?a.gl.STATIC_DRAW:a.gl.DYNAMIC_DRAW,a._vertexAttribs=i||[],a.indicesDirty=!0,a.verticesDirty=!0;for(var o=0,l=0;l<a._vertexAttribs.length;l++)o+=a._vertexAttribs[l].offsetCount;return a.vertexStride=4*o,a.vertices=new Float32Array(a.numVerts),a.indices=new Uint16Array(a.numIndices),a.context.addManagedObject(a),a.create=function(){a.gl=a.context.gl;var e=a.gl;a.vertexBuffer=e.createBuffer(),a.indexBuffer=a.numIndices>0?e.createBuffer():null,a.dirty=!0},a.destroy=function(){a.vertices=null,a.indices=null,a.vertexBuffer&&a.gl&&a.gl.deleteBuffer(a.vertexBuffer),a.indexBuffer&&a.gl&&a.gl.deleteBuffer(a.indexBuffer),a.vertexBuffer=null,a.indexBuffer=null,a.context&&a.context.removeManagedObject(a),a.gl=null,a.context=null},a._updateBuffers=function(e,t){var r=a.gl;if(a.numIndices>0&&(e||r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a.indexBuffer),a.indicesDirty&&(r.bufferData(r.ELEMENT_ARRAY_BUFFER,a.indices,a.indexUsage),a.indicesDirty=!1)),e||r.bindBuffer(r.ARRAY_BUFFER,a.vertexBuffer),a.verticesDirty){if(t){var n=a.vertices.subarray(0,t);r.bufferSubData(r.ARRAY_BUFFER,0,n)}else r.bufferData(r.ARRAY_BUFFER,a.vertices,a.vertexUsage);a.verticesDirty=!1}},a.draw=function(e,t,r,n){if(0!==t){var i=a.gl;r=r||0,a._updateBuffers(!0,n),a.numIndices>0?i.drawElements(e,t,i.UNSIGNED_SHORT,2*r):i.drawArrays(e,r,t)}},a.bind=function(e){var t=a.gl,r=0,n=a.vertexStride;a._updateBuffers();for(var i=0;i<a._vertexAttribs.length;i++){var o=a._vertexAttribs[i],l=null===o.location?e.getAttributeLocation(o.name):o.location;t.enableVertexAttribArray(l),t.vertexAttribPointer(l,o.numComponents,o.type||t.FLOAT,o.normalize,n,r),r+=4*o.offsetCount}},a.unbind=function(e){for(var t=a.gl,r=0;r<a._vertexAttribs.length;r++){var n=a._vertexAttribs[r],i=null===n.location?e.getAttributeLocation(n.name):n.location;t.disableVertexAttribArray(i)}},a.create(),a},YascalGl.mesh.attrib=function(e,t,r,n,i,a){var o={};return o.name=e,o.numComponents=t,o.location="number"==typeof r?r:null,o.type=n,o.normalize=Boolean(i),o.offsetCount="number"==typeof a?a:o.numComponents,o},YascalGl.batcher=function(e,t){var r={};if("object"!=typeof e)throw"GL context not specified.";return r.context=e,r.size=t||500,r.size=Math.min(r.size,1e4),r._createMesh=function(e){var t=4*e*r.getVertexSize(),n=6*e,i=r.context.gl;r.vertices=new Float32Array(t),r.indices=new Uint16Array(n);for(var a=0,o=0;a<n;a+=6,o+=4)r.indices[a+0]=o+0,r.indices[a+1]=o+1,r.indices[a+2]=o+2,r.indices[a+3]=o+0,r.indices[a+4]=o+2,r.indices[a+5]=o+3;var l=YascalGl.mesh(r.context,!1,t,n,r._createVertexAttributes());return l.vertices=r.vertices,l.indices=r.indices,l.vertexUsage=i.DYNAMIC_DRAW,l.indexUsage=i.STATIC_DRAW,l.dirty=!0,l},r._createShader=function(){throw"_createShader not implemented"},r._createVertexAttributes=function(){throw"_createVertexAttributes not implemented"},r.getVertexSize=function(){throw"getVertexSize not implemented"},r.blendingEnabled={set:function(e){var t=r._blendingEnabled;if(r.drawing&&r.flush(),r._blendingEnabled=e,r.drawing&&t!=e){var n=r.context.gl;e?n.enable(n.BLEND):n.disable(n.BLEND)}},get:function(){return r._blendingEnabled}},r.blendSrc={set:function(e){r.drawing&&r.flush(),r._blendSrc=e},get:function(){return r._blendSrc}},r.blendDst={set:function(e){r.drawing&&r.flush(),r._blendDst=e},get:function(){return r._blendDst}},r.setBlendFunction=function(e,t){r.blendSrc=e,r.blendDst=t},r.shader={set:function(e){var t=r.drawing;t&&r.end(),r._shader=e?e:r.defaultShader,t&&r.begin()},get:function(){return r._shader}},r.setColor=function(e,t,n,i){var a="number"==typeof e;a&&"number"==typeof t&&"number"==typeof n?i=i||0===i?i:1:e=t=n=i=a?e:1,r.premultiplied&&(e*=i,t*=i,n*=i),r.color=colorToFloat(~~(255*e),~~(255*t),~~(255*n),~~(255*i))},r.begin=function(){if(r.drawing)throw"batch.end() must be called before begin";if(r.drawing=!0,r._shader.bind(),r.mesh.bind(r._shader),r._blendingEnabled){var e=r.context.gl;e.enable(e.BLEND)}},r._begin=r.begin,r.end=function(){if(!r.drawing)throw"batch.begin() must be called before end";if(r.idx>0&&r.flush(),r.drawing=!1,r.mesh.unbind(r._shader),r._blendingEnabled){var e=r.context.gl;e.disable(e.BLEND)}},r._end=r.end,r._preRender=function(){},r.flush=function(){if(0!==r.idx){var e=r.context.gl;r._blendingEnabled&&r._blendSrc&&r._blendDst&&e.blendFunc(r._blendSrc,r._blendDst),r._preRender();var t=r.getVertexSize(),n=r.idx/(4*t);r.mesh.verticesDirty=!0,r.mesh.draw(e.TRIANGLES,6*n,0,r.idx),r.idx=0}},r._flush=r.flush,r.draw=function(e,t,r,n,i,a,o,l,u){},r.drawVertices=function(e,t,r){},r.drawRegion=function(e,t,n,i,a){r.draw(e.texture,t,n,i,a,e.u,e.v,e.u2,e.v2)},r.destroy=function(){r.vertices=null,r.indices=null,r.size=r.maxVertices=0,r.ownsShader&&r.defaultShader&&r.defaultShader.destroy(),r.defaultShader=null,r._shader=null,r.mesh&&r.mesh.destroy(),r.mesh=null},r};var SHADERPROGRAM={POSITION_ATTRIBUTE:"Position",NORMAL_ATTRIBUTE:"Normal",COLOR_ATTRIBUTE:"Color",TEXCOORD_ATTRIBUTE:"TexCoord"},SPRITEBATCH={VERTEX_SIZE:5,totalRenderCalls:0,DEFAULT_FRAG_SHADER:["precision mediump float;","varying vec2 vTexCoord0;","varying vec4 vColor;","uniform sampler2D u_texture0;","void main(void) {","   gl_FragColor = texture2D(u_texture0, vTexCoord0) * vColor;","}"].join("\n"),DEFAULT_VERT_SHADER:["attribute vec2 "+SHADERPROGRAM.POSITION_ATTRIBUTE+";","attribute vec4 "+SHADERPROGRAM.COLOR_ATTRIBUTE+";","attribute vec2 "+SHADERPROGRAM.TEXCOORD_ATTRIBUTE+"0;","uniform vec2 u_projection;","varying vec2 vTexCoord0;","varying vec4 vColor;","void main(void) {","   gl_Position = vec4( "+SHADERPROGRAM.POSITION_ATTRIBUTE+".x / u_projection.x - 1.0, "+SHADERPROGRAM.POSITION_ATTRIBUTE+".y / -u_projection.y + 1.0 , 0.0, 1.0);","   vTexCoord0 = "+SHADERPROGRAM.TEXCOORD_ATTRIBUTE+"0;","   vColor = "+SHADERPROGRAM.COLOR_ATTRIBUTE+";","}"].join("\n")};YascalGl.spriteBatch=function(e,t){var r=YascalGl.batcher(e,t);return r.projection=new Float32Array(2),r.projection[0]=r.context.width/2,r.projection[1]=r.context.height/2,r.texture=null,r.resize=function(e,t){r.setProjection(e/2,t/2)},r.getVertexSize=function(){return SPRITEBATCH.VERTEX_SIZE},r._createVertexAttributes=function(){var e=r.context.gl;return[YascalGl.mesh.attrib(SHADERPROGRAM.POSITION_ATTRIBUTE,2),YascalGl.mesh.attrib(SHADERPROGRAM.COLOR_ATTRIBUTE,4,null,e.UNSIGNED_BYTE,!0,1),YascalGl.mesh.attrib(SHADERPROGRAM.TEXCOORD_ATTRIBUTE+"0",2)]},r.setProjection=function(e,t){var n=r.projection[0],i=r.projection[1];r.projection[0]=e,r.projection[1]=t,!r.drawing||e==n&&t==i||(r.flush(),r._updateMatrices())},r._createShader=function(){var e=YascalGl.shaderProgram(r.context,SPRITEBATCH.DEFAULT_VERT_SHADER,SPRITEBATCH.DEFAULT_FRAG_SHADER);return e.log,e},r.updateMatrices=function(){r._shader.setUniformfv("u_projection",r.projection)},r._preRender=function(){r.texture&&r.texture.bind()},r.begin=function(){var e=r.context.gl;r._begin(),r.updateMatrices(),r._shader.setUniformi("u_texture0",0),e.depthMask(!1)},r.end=function(){var e=r.context.gl;r._end(),e.depthMask(!0)},r.flush=function(){r.texture&&0!==r.idx&&(r._flush(),SPRITEBATCH.totalRenderCalls++)},r.draw=function(e,t,n,i,a,o,l,u,c){if(!r.drawing)throw"Illegal State: trying to draw a batch before begin()";if(e){null===r.texture||r.texture.id!==e.id?(r.flush(),r.texture=e):r.idx==r.vertices.length&&r.flush(),i=0===i?i:i||e.width,a=0===a?a:a||e.height,t=t||0,n=n||0;var d=t,f=t+i,s=n,g=n+a;o=o||0,u=0===u?u:u||1,l=l||0,c=0===c?c:c||1;var v=r.color;r.vertices[r.idx++]=d,r.vertices[r.idx++]=s,r.vertices[r.idx++]=v,r.vertices[r.idx++]=o,r.vertices[r.idx++]=l,r.vertices[r.idx++]=f,r.vertices[r.idx++]=s,r.vertices[r.idx++]=v,r.vertices[r.idx++]=u,r.vertices[r.idx++]=l,r.vertices[r.idx++]=f,r.vertices[r.idx++]=g,r.vertices[r.idx++]=v,r.vertices[r.idx++]=u,r.vertices[r.idx++]=c,r.vertices[r.idx++]=d,r.vertices[r.idx++]=g,r.vertices[r.idx++]=v,r.vertices[r.idx++]=o,r.vertices[r.idx++]=c}},r.drawVertices=function(e,t,n){if(!r.drawing)throw"Illegal State: trying to draw a batch before begin()";e&&(r.texture!=e?(r.flush(),r.texture=e):r.idx==r.vertices.length&&r.flush(),n=n||0,r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++],r.vertices[r.idx++]=t[n++])},r._shader=r._createShader(),r._blendSrc=r.context.gl.ONE,r._blendDst=r.context.gl.ONE_MINUS_SRC_ALPHA,r._blendingEnabled=!0,r.defaultShader=r._shader,r.ownsShader=!0,r.idx=0,r.drawing=!1,r.mesh=r._createMesh(r.size),r.color=YascalGl.numberUtil.colorToFloat(255,255,255,255),r.premultiplied=!0,r};